import google.generativeai as genai
from Markdown2docx import Markdown2docx


def generate(api_key, project_charter):

    genai.configure(api_key=api_key)

    # Create the model
    generation_config = {
    "temperature": 1,
    "top_p": 0.95,
    "top_k": 40,
    "max_output_tokens": 8192,
    "response_mime_type": "text/plain",
    }

    model = genai.GenerativeModel(
    model_name="gemini-2.0-flash-exp",
    generation_config=generation_config,
    )

    chat_session = model.start_chat(
    history=[
        {
        "role": "user",
        "parts": [
            "Act as a senior project manager with experience in software projects. Write a Risk Management Plan that identifies, assesses, and outlines strategies to manage risks in the project, based on the following Project Charter:\n\n{{input}}\n\n--\nEND OF THE PROJECT CHARTER\n\nNow please write the Risk Management Plan:",
        ],
        },
        {
        "role": "model",
        "parts": [
            "Okay, I've reviewed the Project Charter and, as a senior project manager, I'm ready to create a comprehensive Risk Management Plan. This plan will be a living document and will be revisited and updated throughout the project lifecycle.\n\n**Risk Management Plan**\n\n**1. Introduction**\n\nThis Risk Management Plan outlines the processes and procedures for identifying, assessing, responding to, and monitoring risks associated with the \"[Project Name]\" project. This plan ensures that risks are proactively managed to minimize negative impacts on the projectâ€™s schedule, budget, scope, and overall objectives.\n\n**2. Purpose**\n\nThe purpose of this plan is to:\n\n*   Establish a consistent and repeatable approach to risk management.\n*   Identify potential risks that could impact the project.\n*   Analyze and prioritize risks based on their likelihood and impact.\n*   Develop and implement effective strategies to mitigate or avoid risks.\n*   Monitor risks throughout the project lifecycle.\n*   Communicate risk information to stakeholders in a timely and transparent manner.\n\n**3. Risk Management Methodology**\n\nThis project will utilize a qualitative risk analysis approach, focusing on understanding the probability and impact of risks. We will also employ the following steps:\n\n*   **Risk Identification:** Brainstorming sessions, expert interviews, and review of historical project data.\n*   **Qualitative Risk Analysis:** Utilizing a probability and impact matrix to categorize risks.\n*   **Risk Response Planning:** Developing mitigation, avoidance, transfer, or acceptance strategies.\n*   **Risk Monitoring and Control:** Regularly reviewing and updating the risk register.\n\n**4. Roles and Responsibilities**\n\n| **Role**                     | **Responsibilities**                                                                                                                      |\n| :--------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------- |\n| **Project Manager**          | Overall responsibility for risk management. Facilitates risk identification and analysis meetings, implements mitigation plans, and monitors risks. |\n| **Project Team Members**   | Identifying potential risks within their area of responsibility and providing input to mitigation plans.                                    |\n| **Stakeholders**             | Providing input on potential risks that may impact their business or functional areas. Approving risk mitigation plans.               |\n| **[Optional: Technical Lead]** | Provides technical expertise for risk assessment and mitigation for technical risks.  |\n\n**5. Risk Identification**\n\nBased on the Project Charter, the following initial risks have been identified. This list will be expanded upon throughout the project:\n\n| **Risk ID** | **Risk Description**                                                                                              | **Category**       |\n| --------- | ---------------------------------------------------------------------------------------------------------------- | ------------- |\n| R1        | **Scope Creep:** Requirements changing significantly after the initial scope has been defined.                      | Scope           |\n| R2        | **Delays in Vendor Delivery:** Vendor not delivering required components on time.                                   | Procurement      |\n| R3        | **Inadequate Resources:** Project team not having sufficient staff to complete the tasks.                              | Resource      |\n| R4        | **Technical Challenges:** Unexpected issues arising with the selected technology or platform.                        | Technical       |\n| R5        | **Integration Issues:** Difficulties in integrating different components of the system.                            | Technical      |\n| R6        | **Budget Overruns:** Project expenses exceeding the allocated budget.                                                 | Financial       |\n| R7        | **Communication Breakdown:** Inadequate communication between the project team and stakeholders.                  | Communication |\n| R8        | **Data Security Breach:** Potential for sensitive data to be compromised during the project.                           | Security      |\n| R9        | **Lack of Stakeholder Buy-in:** Stakeholders not fully supporting the project.                                        | Stakeholder    |\n| R10       | **Poor Quality Code/Testing:** Software development or testing quality lower than desired.                         | Quality         |\n| R11       | **Legal Compliance Issues:** Failure to comply with relevant regulations, legal requirements, or industry standards | Compliance       |\n\n*   **Note:** This is not an exhaustive list and other risks may emerge during the project. Risk identification is an ongoing activity.\n\n**6. Qualitative Risk Analysis**\n\nRisks will be analyzed using a 3x3 Probability and Impact Matrix (Low, Medium, High):\n\n|                 | **Impact**       | **Low (1)**          | **Medium (2)**                                     | **High (3)**                                        |\n| :-------------- | --------------- | :------------------- | :------------------------------------------------- | :-------------------------------------------------- |\n| **Probability** |                 |                      |                                                    |                                                     |\n| **Low (1)**     | Negligible       | Low Priority         | Low to Medium Priority                          | Medium Priority                                 |\n| **Medium (2)**  | Minor           | Low to Medium Priority    | Medium Priority                            | High Priority                      |\n| **High (3)**    | Major        | Medium Priority            | High Priority                  | High Priority (Requires Immediate Action) |\n\n**Risk Assessment:**\n\n*   **Probability:** The likelihood of the risk occurring (Low, Medium, High).\n*   **Impact:** The effect of the risk on project objectives (Low, Medium, High).\n\n| **Risk ID** | **Risk Description**                                                                         | **Probability** | **Impact** | **Risk Score** | **Priority**   |\n| ----------- | -------------------------------------------------------------------------------------------- | --------------- | ---------- | -------------- | -------------- |\n| R1          | Scope Creep                                                                              | Medium         | Medium      | 4              | Medium         |\n| R2          | Delays in Vendor Delivery                                                                | Medium         | High       | 6              | High           |\n| R3          | Inadequate Resources                                                                     | Low            | Medium      | 2              | Low            |\n| R4          | Technical Challenges                                                                     | Medium          | Medium      | 4              | Medium         |\n| R5          | Integration Issues                                                                     | Medium          | High       | 6              | High           |\n| R6          | Budget Overruns                                                                         | Low            | High        | 3              | Medium         |\n| R7          | Communication Breakdown                                                                   | Low             | Medium     | 2              | Low            |\n| R8          | Data Security Breach                                                                     | Low            | High        | 3              | Medium         |\n| R9          | Lack of Stakeholder Buy-in                                                                 | Low             | Medium     | 2              | Low            |\n| R10         | Poor Quality Code/Testing                                                                | Medium         | Medium    | 4              | Medium        |\n| R11         | Legal Compliance Issues                                                                 | Low             | High    | 3             | Medium       |\n\n**7. Risk Response Planning**\n\nThe following strategies will be employed to manage identified risks:\n\n| **Risk ID** | **Risk Description**          | **Response Strategy**        | **Response Plan**                                                                                                                                                                                                       | **Responsible Party** |\n| ----------- | ---------------------------- | --------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- |\n| R1          | Scope Creep                  | Mitigate                    | Implement a formal change management process. Rigorous review and approval of change requests. Track changes and their impacts on schedule/budget.  | Project Manager      |\n| R2          | Delays in Vendor Delivery      | Mitigate                    | Establish clear service level agreements. Regular check-ins and progress tracking with the vendor. Have backup vendors identified if possible.                                                                           | Project Manager      |\n| R3          | Inadequate Resources          | Mitigate                    | Conduct a resource assessment early in the project. Work with resource managers to secure necessary staff and/or contract out tasks if needed. | Project Manager      |\n| R4          | Technical Challenges         | Mitigate                    | Conduct thorough proof of concept testing. Use experienced technical resources. Have a backup plan with alternative technology if needed.                                                                               | Technical Lead         |\n| R5          | Integration Issues            | Mitigate                     | Plan for integration early, regular testing and documentation of interfaces.  Employ automated integration testing if feasible.                                                                                           | Technical Lead         |\n| R6          | Budget Overruns              | Mitigate                    | Monitor budget regularly. Establish a contingency fund. Implement strict expenditure tracking and control. Conduct regular financial reviews. | Project Manager       |\n| R7          | Communication Breakdown       | Mitigate                    | Establish a communication plan. Maintain transparent reporting and have regular project team meetings. Maintain a common project information platform.  | Project Manager      |\n| R8          | Data Security Breach        | Mitigate                    |  Implement strict data access controls, enforce secure data management practices, regularly audit security protocols. Conduct security training.   | Project Manager     |\n| R9          | Lack of Stakeholder Buy-in     | Mitigate                    | Engage stakeholders early and often. Regular communication with stakeholders including project updates and demonstrations.     | Project Manager      |\n| R10         | Poor Quality Code/Testing     | Mitigate                    | Implement rigorous code review process, mandatory unit testing, have dedicated test team or test resources involved in each phase of development.  | Technical Lead       |\n| R11         | Legal Compliance Issues      | Mitigate                    | Engage legal counsel to ensure the solution complies with required regulations. Conduct reviews at milestones. Ensure compliance during implementation | Project Manager       |\n\n**8. Risk Monitoring and Control**\n\n*   **Regular Reviews:** The risk register will be reviewed during weekly project meetings, and updated on a monthly basis or as needed with new identified risks and their associated analysis.\n*   **Change Management:** Any changes to the project that impact risk will be assessed and addressed through the established change management process.\n*   **Reporting:** Risk reports will be included in regular project status updates to stakeholders.\n*   **Escalation:** High priority risks will be escalated to the appropriate stakeholders for visibility and action.\n\n**9. Communication**\n\n*   Risk information will be communicated to stakeholders through regular status updates, meetings, and reports.\n*   All project team members are responsible for raising potential risks to the project manager.\n\n**10. Documentation**\n\n*   This Risk Management Plan will be a living document that will be reviewed, updated, and controlled throughout the project's lifespan.\n*   The Risk Register will be maintained and used to track all risks and related information.\n\n**11. Conclusion**\n\nThis Risk Management Plan establishes a framework for proactively identifying, analyzing, and responding to potential risks in the [Project Name] project. By actively engaging in risk management practices, the project team will be better equipped to deliver a successful project that meets its objectives within scope, budget, and schedule. This plan is not static and will evolve with new insights gained throughout the project.\n\nThis detailed Risk Management Plan provides a solid foundation for managing potential risks throughout the lifecycle of your project. Remember that consistent application and continuous review are key for successful risk management. Let me know if you have any other questions.\n",
        ],
        },
    ]
    )

    response = chat_session.send_message("INSERT_INPUT_HERE")

    #testing print(response.text)
    # Save response as Word Document
    #testing print(repsonse.result)
    my_file = open('risk_management.md', 'w')
    my_file.write(response.result)
    my_file.close()

    word_file = Markdown2docx('risk_management')
    word_file.eat_soup()
    word_file.write_html()
    word_file.save()
    return response.result